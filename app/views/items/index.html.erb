<div id="background"></div>

<div class="main_wrapper">

<% for item in @items %>

    <div class="post_wrapper">


        <div class="top_wrapper d-flex align-items-center d-flex justify-content-between">
            <span class="title"><div id="profile_pic"></div><%= item.name %></span>

        </div>
        <div id="photo"><%= link_to item_path(item) do %><%= cl_image_tag(item.public_id) %><% end %>
            <% if item.availability == 'reserved' %>
                <div id="reserved">RESERVED</div>
            <% end %>
       </div>
        <div class="description_wrapper">
            <div id="description"><%= item.description.truncate_words(10) %></div>


            <div id="timestamp"><%= item.updated_at.strftime('%d %B') %></div>
            <div class="bottom_wrapper">
                <p id="username">posted by  <a href = "/users/<%= item.user.id %>" ><%= item.user.name %></a></p>
                    <% if user_signed_in? && current_user.email == item.user.email && item.availability == "Available"%>
                        <div class="controls"><%= link_to 'Edit', edit_item_path(item) %> | <%= link_to 'Delete', item_path(item), method: :delete, data: { confirm: 'Are you sure?' } %>

                        </div>

                    <% elsif user_signed_in? && current_user.email == item.user.email && item.availability == "reserved"%>
                        <div class="controls">
                            <%= link_to 'Edit', edit_item_path(item) %> | <%= link_to 'Delete', item_path(item), method: :delete, data: { confirm: 'Are you sure?' } %>
                        </div>

                        <form method = 'PATCH' action = '/items/<%= item.id %>/done' ><button class ="reserved_btn btn btn-info"> Done</button></form>


                    <% elsif user_signed_in? && current_user.email != item.user.email && item.availability == "Available" %>
                        <form method = 'PATCH' action ='/items/<%= item.id %>/reserve'><button class ="reserved_btn btn btn-info reserve"> Reserve </button></form>

                    <% elsif user_signed_in? && current_user.email != item.user.email &&  current_user.reserve.length > 0 %>
                         <form method = 'PATCH' action ='/items/<%= item.id %>/release'><button class ="reserved_btn btn btn-info reserve"> Release </button></form>

                    <% end %>
            </div>

        </div>
    </div>
<% end %>
</div>


</div>